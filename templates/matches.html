{% extends "base.html" %}

{% block title %}
<script type="text/javascript" src="/static/chat.js"></script>
<title>Matches</title>
{% endblock %}

{% block newStyle %}
<style>
    /* Entire chat page */
    #boxInside {
        text-align: center;
        font-family: Arial;
        width: 100%;
        height: 100%;
    }
    .messagesContainer {
        border: 1px solid #F25A5A;
        height: 80%;
    }
    .profileHeader {
        text-align: center;
        color: #F25A5A;
        font-size: 200%;
        font-family: Arial;
        text-decoration: none;
        float: center;
        padding: 17px 15px 8px 15px;
    }
    /* Chat sidebar with names of matches */
    .chatSidebar {
        min-width: 100px;
        width: 29.8%;
        height: 100%;
        max-height: 500px;
        overflow-y: auto;
        overflow-x: hidden;
        border-right: 1px solid #F25A5A;
        overflow: hidden;
        float:left;
        color: #FFFFFF;
    }
    .messageInput {
        padding: 5px;
        text-align: center;
    }
    .matchChat {
        border: 1px solid #FFFFFF;
        background-color: #F28080;
        height: 75px;
        width: 100%;
        font-family: Arial;
    }
    .matchChat.selected {
        background-color: #F25A5A;
    }
    li.matchChat:hover {
        background-color: #F25A5A;
    }
    .matchChatInside {
        padding:9px;
        height: 60px;
        width: 92%;
        display: block;
        text-overflow: ellipsis;
    }

    /* Messages from one match */
    .currentChatContainer {
        height: 100%;
        overflow:hidden;
        position: relative;
    }
    .chatHeader {
        padding: 6px 0px;
        text-align: center;
        background-color: #F25A5A;
        color: #FFFFFF;
    }
    .currentChat {
        padding: 10px;
        overflow: auto;
    }
    .dateCreated {
        font-size: 60%;
        font-style: #DEDEDE;
        display: block;
    }
    .dateCreated.self {
        text-align: right;
        padding: 0 8px 0 0;
    }
    .dateCreated.other {
        text-align: left;
        padding: 0 0 0 8px;
    }
    .chatBubble {
        padding: 8px 8px 10px 8px;
        width: auto;
        list-style-type: none;
        word-break: break-all;
        display: block;
    }
    .chatBubble.self {
        text-align: right;
    }
    .chatBubble.other {
        text-align: left;
    }
    .spanSelf {
        padding: 6px 8px;
        background-color: #FFE0E0;
        border-radius: 10px 2px 2px 10px;
    }
    .spanOther {
        padding: 6px 8px;
        background-color: #E0E0E0;
        border-radius: 2px 10px 10px 2px;
    }
    .messageInput.send {
        position: absolute;
        bottom: 0;
        width: 100%;
        text-align: left;
    }
    .sendMessage {
        width: 99%;
    }
</style>
{% endblock %}

{% block content %}
<div class="box">
	<div><p class="profileHeader">{{ current_user.nickname }}'s Matches</p></div>
	<div class="messagesContainer">
		<div class="chatSidebar">
            <div class="messageInput">
                <input placeholder="Search" type="text"/>
            </div>
            <ul id="ul">
                {% if current_user.conversations %}
                    {% for conversation in current_user.conversations %}
                        {% if loop.index-1 == displayConvo %}
                            <li class="matchChat selected">
                                <div class="matchChatInside">
                                    <p style="padding: 0 0 5px 0;"><b>
                                        {% for member in conversation.party %}
                                            {% if current_user.id != member.id %}
                                                {{ member.nickname }} 
                                            {% endif %}
                                        {% endfor %}
                                    </b></p>
                                    <p style="font-size: 85%;">{{ conversation.lastMessage }}</p>
                                </div>
                            </li>
                        {% else %}
                            <form method="post" name="changeChat{{ loop.index -1 }}" id="changeChat">
                                <li onclick="changeChat{{ loop.index -1 }}.submit();" class="matchChat">
                                    <div class="matchChatInside">
                                        <p style="padding: 0 0 5px 0;"><b>
                                            {% for member in conversation.party %}
                                                {% if current_user.id != member.id %}
                                                    {{ member.nickname }} 
                                                {% endif %}
                                            {% endfor %}
                                        </b></p>
                                        <p style="font-size: 85%;">{{ conversation.lastMessage }}</p>
                                    </div>
                                </li>
                                <input type="hidden" name="index" value="{{ loop.index -1}}">
                            </form>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
        <div class="currentChatContainer">
            <div class="chatHeader"><b style="font-family: Arial;">
                {% for member in current_user.conversations[displayConvo].party %}
                    {% if current_user.id != member.id %}
                        {{ member.nickname }} 
                    {% endif %}
                {% endfor %}
            </b></div>
            <ul id="currentChat" class="currentChat">
                {% for message in current_user.conversations[displayConvo].messages %}
                    {% if message.sender == current_user.id %}
                        <li class="dateCreated self">{{ message.dateCreated.strftime('%Y-%M-%d') }} at {{ message.dateCreated.strftime('%r') }}</li>
                        <li class="chatBubble self">
                            <span class="spanSelf">{{message.text}}</span></li>
                    {% else %}
                        <li class="dateCreated other">{{ message.dateCreated.strftime('%Y-%M-%d') }} at {{ message.dateCreated.strftime('%r') }}</li>
                        <li class="chatBubble other">
                            <span class="spanOther">{{message.text}}</span></li>
                    {% endif %}
                {% endfor %}
            </ul>
            <form method="post" name="sendMessageForm" id="changeChat">
                <div class="messageInput send">
                    <input class="sendMessage" name="messageSend" id="messageSend" placeholder="Send message with Enter" type="text"/>
                    <input name="indexSend" id="indexSend" type="hidden" value="{{ displayConvo }}"/>
                </div>
            </form>
        </div>
	</div>
</div>
{% endblock %}